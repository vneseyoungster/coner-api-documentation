<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coner Backend API Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #1f2937;
            --light-bg: #f9fafb;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --code-bg: #f3f4f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: #ffffff;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header .version {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* Navigation */
        .nav {
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 99;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            gap: 2rem;
            overflow-x: auto;
        }

        .nav a {
            display: block;
            padding: 1rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .nav a:hover {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Section */
        .section {
            margin-bottom: 3rem;
            scroll-margin-top: 100px;
        }

        .section h2 {
            font-size: 1.875rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        .section h3 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .section h4 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }

        .section p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .section ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .section li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        /* Endpoint Card */
        .endpoint {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .method {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        .method.get {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .method.post {
            background-color: #d1fae5;
            color: #065f46;
        }

        .method.put {
            background-color: #fef3c7;
            color: #92400e;
        }

        .method.patch {
            background-color: #e0e7ff;
            color: #3730a3;
        }

        .method.delete {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .endpoint-path {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .endpoint-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        /* Code Block */
        .code-block {
            background-color: var(--dark-bg);
            color: #d1d5db;
            padding: 1.5rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
            position: relative;
        }

        .code-block pre {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
        }

        .copy-btn {
            background-color: #374151;
            color: #d1d5db;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #4b5563;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        thead {
            background-color: var(--light-bg);
        }

        th {
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background-color: var(--light-bg);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge.required {
            background-color: #fef3c7;
            color: #92400e;
        }

        .badge.optional {
            background-color: #e0e7ff;
            color: #3730a3;
        }

        /* Alert Box */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .alert.info {
            background-color: #dbeafe;
            border-color: #2563eb;
            color: #1e40af;
        }

        .alert.warning {
            background-color: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert.success {
            background-color: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .alert.danger {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .feature-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .feature-card h4 {
            margin-top: 0;
            color: var(--primary-color);
        }

        /* Footer */
        .footer {
            background-color: var(--dark-bg);
            color: #d1d5db;
            padding: 2rem;
            margin-top: 4rem;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 1rem;
            }

            .endpoint-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-content {
                gap: 1rem;
            }
        }

        /* Syntax Highlighting */
        .json-key { color: #93c5fd; }
        .json-string { color: #86efac; }
        .json-number { color: #fbbf24; }
        .json-boolean { color: #f472b6; }
        .json-null { color: #cbd5e1; }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Search */
        .search-box {
            margin-bottom: 2rem;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>Coner Backend API Documentation</h1>
            <p class="version">Version 0.4.0 | Base URL: <code>http://localhost:8080</code></p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#authentication">Authentication</a>
            <a href="#health">Health Check</a>
            <a href="#auth-endpoints">Auth Endpoints</a>
            <a href="#profile-endpoints">Profile Endpoints</a>
            <a href="#errors">Error Handling</a>
            <a href="#examples">Examples</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Authentication Section -->
        <section id="authentication" class="section">
            <h2>Authentication</h2>

            <h3>Authentication Flow</h3>
            <ol>
                <li><strong>Sign Up:</strong> Create account via <code>/auth/signup</code> with email/password</li>
                <li><strong>Sign In:</strong> Authenticate via <code>/auth/signin</code> to receive JWT tokens</li>
                <li><strong>Authorization:</strong> Include JWT in <code>Authorization</code> header for protected routes</li>
                <li><strong>Auto-profile:</strong> First request automatically creates user profile via <code>ensureProfile</code> middleware</li>
            </ol>

            <h3>JWT Token Format</h3>
            <div class="code-block">
                <div class="code-header">
                    <span>HTTP Header</span>
                </div>
                <pre>Authorization: Bearer &lt;access_token&gt;</pre>
            </div>

            <h3>Token Verification</h3>
            <p>All protected routes verify JWT tokens against:</p>
            <ul>
                <li><strong>Signature:</strong> Validated using Supabase JWKS endpoint</li>
                <li><strong>Expiry:</strong> Checked automatically by jose library</li>
                <li><strong>Issuer:</strong> Verified against Supabase issuer</li>
                <li><strong>Logout Cutoff:</strong> Compared against user's <code>logout_at</code> timestamp</li>
            </ul>

            <div class="alert info">
                <strong>Session Management:</strong> Access tokens typically expire after 1 hour. Use refresh tokens to obtain new access tokens without re-authentication.
            </div>
        </section>

        <!-- Health Check -->
        <section id="health" class="section">
            <h2>Health Check</h2>

            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/health</span>
                </div>
                <p class="endpoint-description">Checks the health status of the API server, database, and Redis.</p>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"status"</span>: <span class="json-string">"ok"</span>,
  <span class="json-key">"db"</span>: <span class="json-boolean">true</span>,
  <span class="json-key">"redis"</span>: <span class="json-string">"ok"</span>
}</pre>
                </div>

                <h4>Response (500 Internal Server Error)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"status"</span>: <span class="json-string">"error"</span>,
  <span class="json-key">"error"</span>: <span class="json-string">"Connection refused"</span>
}</pre>
                </div>
            </div>
        </section>

        <!-- Authentication Endpoints -->
        <section id="auth-endpoints" class="section">
            <h2>Authentication Endpoints</h2>
            <p>All authentication endpoints are prefixed with <code>/auth</code>.</p>

            <!-- Sign Up -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/signup</span>
                </div>
                <p class="endpoint-description">Create a new user account.</p>

                <h4>Request Body</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"email"</span>: <span class="json-string">"user@example.com"</span>,
  <span class="json-key">"password"</span>: <span class="json-string">"securePassword123"</span>,
  <span class="json-key">"displayName"</span>: <span class="json-string">"Alice Smith"</span>
}</pre>
                </div>

                <h4>Validation Rules</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Validation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>email</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>Valid email format</td>
                        </tr>
                        <tr>
                            <td><code>password</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>Minimum 8 characters</td>
                        </tr>
                        <tr>
                            <td><code>displayName</code></td>
                            <td>string</td>
                            <td><span class="badge optional">Optional</span></td>
                            <td>1-100 characters if provided</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Response (201 Created)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"userId"</span>: <span class="json-string">"550e8400-e29b-41d4-a716-446655440000"</span>
}</pre>
                </div>

                <h4>Error Responses</h4>
                <ul>
                    <li><code>400 Bad Request</code>: Validation error or email already exists</li>
                    <li><code>500 Internal Server Error</code>: Server error during account creation</li>
                </ul>
            </div>

            <!-- Sign In -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/signin</span>
                </div>
                <p class="endpoint-description">Authenticate an existing user.</p>

                <h4>Request Body</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"email"</span>: <span class="json-string">"user@example.com"</span>,
  <span class="json-key">"password"</span>: <span class="json-string">"securePassword123"</span>
}</pre>
                </div>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"access_token"</span>: <span class="json-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span>,
  <span class="json-key">"refresh_token"</span>: <span class="json-string">"v1.MRjWyLHe1KIrqT..."</span>,
  <span class="json-key">"expires_in"</span>: <span class="json-number">3600</span>
}</pre>
                </div>
            </div>

            <!-- Get Current User -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/auth/me</span>
                </div>
                <p class="endpoint-description">Get information about the currently authenticated user.</p>

                <div class="alert info">
                    <strong>Authentication Required:</strong> This endpoint requires a valid JWT token in the Authorization header.
                </div>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"ok"</span>: <span class="json-boolean">true</span>,
  <span class="json-key">"user"</span>: {
    <span class="json-key">"id"</span>: <span class="json-string">"550e8400-e29b-41d4-a716-446655440000"</span>,
    <span class="json-key">"email"</span>: <span class="json-string">"user@example.com"</span>
  }
}</pre>
                </div>
            </div>

            <!-- Global Logout -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/logout-all</span>
                </div>
                <p class="endpoint-description">Invalidate all active sessions for the current user across all devices.</p>

                <div class="alert warning">
                    <strong>Important:</strong> This will immediately invalidate all tokens for this user, including the one used to make this request.
                </div>

                <h4>How It Works</h4>
                <ol>
                    <li>Sets <code>logout_at = NOW()</code> in the database (immediate cutoff)</li>
                    <li>Calls Supabase Admin API to revoke all refresh tokens</li>
                    <li>Purges middleware cache for instant invalidation</li>
                </ol>

                <h4>Response (204 No Content)</h4>
                <p>Empty response body on success.</p>
            </div>

            <!-- Bootstrap Profile -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method post">POST</span>
                    <span class="endpoint-path">/auth/bootstrap</span>
                </div>
                <p class="endpoint-description">Explicitly create user profile (optional - normally done automatically).</p>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"ok"</span>: <span class="json-boolean">true</span>
}</pre>
                </div>
            </div>
        </section>

        <!-- Profile Endpoints -->
        <section id="profile-endpoints" class="section">
            <h2>User Profile Endpoints</h2>
            <p>All user profile endpoints are prefixed with <code>/users</code> and require authentication.</p>

            <div class="alert info">
                <strong>Middleware Chain:</strong> <code>requireAuth</code> → <code>ensureProfile</code> → route handler
            </div>

            <!-- Get Current Profile -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/users/profile</span>
                </div>
                <p class="endpoint-description">Get detailed profile information for the authenticated user.</p>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"full_name"</span>: <span class="json-string">"Alice Smith"</span>,
  <span class="json-key">"dob"</span>: <span class="json-string">"1995-03-15"</span>,
  <span class="json-key">"sex"</span>: <span class="json-string">"female"</span>,
  <span class="json-key">"phone_number"</span>: <span class="json-string">"1234567890"</span>,
  <span class="json-key">"address"</span>: <span class="json-string">"123 Main St, San Francisco, CA 94102"</span>,
  <span class="json-key">"school"</span>: <span class="json-string">"Stanford University"</span>,
  <span class="json-key">"major"</span>: <span class="json-string">"Computer Science"</span>
}</pre>
                </div>
            </div>

            <!-- First-Time Profile Setup -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method put">PUT</span>
                    <span class="endpoint-path">/users/profile-first</span>
                </div>
                <p class="endpoint-description">Complete the profile with all required information (first-time setup only).</p>

                <div class="alert warning">
                    <strong>One-Time Only:</strong> This endpoint can only be called <strong>once</strong> per user. All fields are required for first-time setup.
                </div>

                <h4>Request Body</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"full_name"</span>: <span class="json-string">"Alice Smith"</span>,
  <span class="json-key">"dob"</span>: <span class="json-string">"1995-03-15"</span>,
  <span class="json-key">"sex"</span>: <span class="json-string">"female"</span>,
  <span class="json-key">"phone_number"</span>: <span class="json-string">"1234567890"</span>,
  <span class="json-key">"address"</span>: <span class="json-string">"123 Main St, San Francisco, CA 94102"</span>,
  <span class="json-key">"school"</span>: <span class="json-string">"Stanford University"</span>,
  <span class="json-key">"major"</span>: <span class="json-string">"Computer Science"</span>
}</pre>
                </div>

                <h4>Validation Rules</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Validation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>full_name</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>1-255 characters</td>
                        </tr>
                        <tr>
                            <td><code>dob</code></td>
                            <td>date</td>
                            <td><span class="badge required">Required</span></td>
                            <td>Age 0-150 years</td>
                        </tr>
                        <tr>
                            <td><code>sex</code></td>
                            <td>enum</td>
                            <td><span class="badge required">Required</span></td>
                            <td>"male", "female", or "other"</td>
                        </tr>
                        <tr>
                            <td><code>phone_number</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>8-15 digits only</td>
                        </tr>
                        <tr>
                            <td><code>address</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>1-500 characters</td>
                        </tr>
                        <tr>
                            <td><code>school</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>1-255 characters</td>
                        </tr>
                        <tr>
                            <td><code>major</code></td>
                            <td>string</td>
                            <td><span class="badge required">Required</span></td>
                            <td>1-255 characters</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Update Profile -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method patch">PATCH</span>
                    <span class="endpoint-path">/users/profile</span>
                </div>
                <p class="endpoint-description">Update profile fields after first-time setup (partial updates allowed).</p>

                <div class="alert danger">
                    <strong>Locked Fields:</strong> <code>full_name</code> and <code>sex</code> cannot be changed after first-time setup.
                </div>

                <h4>Request Body Example</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"phone_number"</span>: <span class="json-string">"9876543210"</span>,
  <span class="json-key">"address"</span>: <span class="json-string">"456 Oak Ave, New York, NY 10001"</span>,
  <span class="json-key">"school"</span>: <span class="json-string">"MIT"</span>
}</pre>
                </div>

                <h4>Important Notes</h4>
                <ul>
                    <li>All fields are optional - only include fields you want to update</li>
                    <li>Omitted fields will retain their current values</li>
                    <li>Attempting to update locked fields will result in a <code>400 Bad Request</code> error</li>
                </ul>
            </div>

            <!-- Get Legacy Profile -->
            <div class="endpoint">
                <div class="endpoint-header">
                    <span class="method get">GET</span>
                    <span class="endpoint-path">/users/me</span>
                </div>
                <p class="endpoint-description">Get basic profile information (legacy endpoint).</p>

                <h4>Response (200 OK)</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>JSON Response</span>
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre>{
  <span class="json-key">"id"</span>: <span class="json-string">"550e8400-e29b-41d4-a716-446655440000"</span>,
  <span class="json-key">"display_name"</span>: <span class="json-string">"Alice Smith"</span>,
  <span class="json-key">"avatar_url"</span>: <span class="json-string">"https://cdn.example.com/avatar.png"</span>,
  <span class="json-key">"email"</span>: <span class="json-string">"user@example.com"</span>,
  <span class="json-key">"profession"</span>: <span class="json-string">"Software Engineer"</span>,
  <span class="json-key">"company"</span>: <span class="json-string">"Tech Corp"</span>,
  <span class="json-key">"bio"</span>: <span class="json-string">"Passionate about building great products"</span>,
  <span class="json-key">"skills"</span>: [<span class="json-string">"JavaScript"</span>, <span class="json-string">"React"</span>, <span class="json-string">"Node.js"</span>],
  <span class="json-key">"work_style"</span>: <span class="json-string">"collaborative"</span>,
  <span class="json-key">"years_experience"</span>: <span class="json-number">5</span>,
  <span class="json-key">"linkedin_url"</span>: <span class="json-string">"https://linkedin.com/in/alice"</span>,
  <span class="json-key">"portfolio_url"</span>: <span class="json-string">"https://alice.dev"</span>,
  <span class="json-key">"created_at"</span>: <span class="json-string">"2025-01-15T10:30:00Z"</span>,
  <span class="json-key">"updated_at"</span>: <span class="json-string">"2025-01-20T14:22:00Z"</span>,
  <span class="json-key">"last_seen_at"</span>: <span class="json-string">"2025-01-25T09:15:00Z"</span>,
  <span class="json-key">"is_deleted"</span>: <span class="json-boolean">false</span>
}</pre>
                </div>
            </div>
        </section>

        <!-- Error Handling -->
        <section id="errors" class="section">
            <h2>Error Handling</h2>

            <h3>Error Response Format</h3>
            <p>All errors follow a consistent JSON format:</p>

            <div class="code-block">
                <div class="code-header">
                    <span>JSON</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>{
  <span class="json-key">"error"</span>: <span class="json-string">"Error message here"</span>
}</pre>
            </div>

            <h3>Validation Errors</h3>
            <p>Zod validation errors include detailed field-level information:</p>

            <div class="code-block">
                <div class="code-header">
                    <span>JSON</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>{
  <span class="json-key">"error"</span>: <span class="json-string">"ValidationError"</span>,
  <span class="json-key">"details"</span>: {
    <span class="json-key">"email"</span>: [<span class="json-string">"Please provide a valid email address"</span>],
    <span class="json-key">"password"</span>: [<span class="json-string">"Password must be at least 8 characters long"</span>]
  }
}</pre>
            </div>

            <h3>HTTP Status Codes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Meaning</th>
                        <th>Common Causes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>200</code></td>
                        <td>OK</td>
                        <td>Successful GET/PATCH request</td>
                    </tr>
                    <tr>
                        <td><code>201</code></td>
                        <td>Created</td>
                        <td>Successful POST request (resource created)</td>
                    </tr>
                    <tr>
                        <td><code>204</code></td>
                        <td>No Content</td>
                        <td>Successful DELETE or logout request</td>
                    </tr>
                    <tr>
                        <td><code>400</code></td>
                        <td>Bad Request</td>
                        <td>Validation error or invalid request</td>
                    </tr>
                    <tr>
                        <td><code>401</code></td>
                        <td>Unauthorized</td>
                        <td>Missing or invalid JWT token</td>
                    </tr>
                    <tr>
                        <td><code>404</code></td>
                        <td>Not Found</td>
                        <td>Resource not found</td>
                    </tr>
                    <tr>
                        <td><code>500</code></td>
                        <td>Internal Server Error</td>
                        <td>Server-side error</td>
                    </tr>
                </tbody>
            </table>

            <h3>Common Error Scenarios</h3>

            <div class="alert danger">
                <strong>Authentication Error:</strong>
                <pre style="margin-top: 0.5rem; background: transparent; padding: 0;">{ "error": "Unauthorized: JWT token missing or invalid" }</pre>
                <p style="margin-top: 0.5rem; margin-bottom: 0;"><strong>Solution:</strong> Ensure valid JWT token is included in Authorization header.</p>
            </div>

            <div class="alert warning">
                <strong>Profile Already Initialized:</strong>
                <pre style="margin-top: 0.5rem; background: transparent; padding: 0;">{ "error": "Profile already initialized" }</pre>
                <p style="margin-top: 0.5rem; margin-bottom: 0;"><strong>Solution:</strong> Use PATCH /users/profile for updates instead.</p>
            </div>

            <div class="alert warning">
                <strong>Locked Field Update:</strong>
                <pre style="margin-top: 0.5rem; background: transparent; padding: 0;">{ "error": "ValidationError", "details": { "full_name": ["Cannot update full name after first completion"] } }</pre>
                <p style="margin-top: 0.5rem; margin-bottom: 0;"><strong>Solution:</strong> Remove locked fields (full_name, sex) from update request.</p>
            </div>
        </section>

        <!-- Examples -->
        <section id="examples" class="section">
            <h2>Examples</h2>

            <h3>Complete Authentication Flow</h3>

            <h4>1. Sign Up</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>cURL</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>curl -X POST http://localhost:8080/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "securePass123",
    "displayName": "Alice Smith"
  }'</pre>
            </div>

            <h4>2. Sign In</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>cURL</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>curl -X POST http://localhost:8080/auth/signin \
  -H "Content-Type: application/json" \
  -d '{
    "email": "alice@example.com",
    "password": "securePass123"
  }'</pre>
            </div>

            <h4>3. Access Protected Route</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>cURL</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>curl -X GET http://localhost:8080/auth/me \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</pre>
            </div>

            <h3>Complete Profile Setup Flow</h3>

            <h4>1. First-Time Profile Setup</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>cURL</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>curl -X PUT http://localhost:8080/users/profile-first \
  -H "Authorization: Bearer &lt;access_token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "full_name": "Alice Smith",
    "dob": "1995-03-15",
    "sex": "female",
    "phone_number": "1234567890",
    "address": "123 Main St, San Francisco, CA 94102",
    "school": "Stanford University",
    "major": "Computer Science"
  }'</pre>
            </div>

            <h4>2. Update Profile Later</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>cURL</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>curl -X PATCH http://localhost:8080/users/profile \
  -H "Authorization: Bearer &lt;access_token&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "phone_number": "9876543210",
    "address": "456 Oak Ave, New York, NY 10001"
  }'</pre>
            </div>

            <h3>PowerShell Examples</h3>

            <h4>Sign Up</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>PowerShell</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>Invoke-WebRequest -Uri "http://localhost:8080/auth/signup" `
  -Method POST `
  -Headers @{"Content-Type"="application/json"} `
  -Body '{"email":"alice@example.com","password":"securePass123","displayName":"Alice Smith"}'</pre>
            </div>

            <h4>Sign In and Store Token</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>PowerShell</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>$response = Invoke-WebRequest -Uri "http://localhost:8080/auth/signin" `
  -Method POST `
  -Headers @{"Content-Type"="application/json"} `
  -Body '{"email":"alice@example.com","password":"securePass123"}'

$tokens = $response.Content | ConvertFrom-Json
$accessToken = $tokens.access_token</pre>
            </div>

            <h4>Get Profile</h4>
            <div class="code-block">
                <div class="code-header">
                    <span>PowerShell</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre>Invoke-WebRequest -Uri "http://localhost:8080/users/profile" `
  -Method GET `
  -Headers @{"Authorization"="Bearer $accessToken"}</pre>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p><strong>Coner Backend API</strong> | Version 0.4.0</p>
        <p>Maintained by: Coner Development Team | Last Updated: 2025-10-25</p>
    </div>

    <!-- JavaScript -->
    <script>
        // Copy to clipboard functionality
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('pre').textContent;

            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.backgroundColor = '#10b981';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                button.textContent = 'Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // Smooth scroll for navigation links
        document.querySelectorAll('.nav a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Highlight active navigation item on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav a');

            let current = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;

                if (window.pageYOffset >= sectionTop - 150) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.style.color = '';
                link.style.borderBottomColor = 'transparent';

                if (link.getAttribute('href') === '#' + current) {
                    link.style.color = 'var(--primary-color)';
                    link.style.borderBottomColor = 'var(--primary-color)';
                }
            });
        });
    </script>
</body>
</html>
